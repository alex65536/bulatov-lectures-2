dist: bionic

language: generic

addons:
  apt:
    packages:
      # required to build
      - cm-super
      - texlive
      - texlive-lang-cyrillic
      - texlive-science
      - texlive-latex-extra
      - latexmk

install:
    # download a newer latexmk
    - curl https://ctan.mirror.norbert-ruehl.de/support/latexmk.zip -o /tmp/latexmk.zip
    - unzip /tmp/latexmk.zip latexmk/latexmk.pl

script: |
    if [[ "$TRAVIS_BRANCH" == "devel" ]]; then
        make LATEXMK="./latexmk/latexmk.pl" build
    else
        make LATEXMK="./latexmk/latexmk.pl" LATEXMK_FLAGS="-Werror" style build
    fi

before_deploy: |
    # rename the pdf file
    cp main.pdf bulatov2.pdf
    # set up git user name and tag this commit
    git config --local user.name "travis"
    git config --local user.email "travis"
    TRAVIS_TAG=latest
    [[ "$TRAVIS_BRANCH" == "devel" ]] && TRAVIS_TAG=devel-latest
    export TRAVIS_TAG
    echo "Branch is: $TRAVIS_BRANCH"
    echo "Using tag: $TRAVIS_TAG"
    git tag -f $TRAVIS_TAG

deploy:
  provider: releases
  api_key:
    secure: "qD0YwqvBTjtBNMM4Ako9aKsg0gAAHxzupDYSb5x2aFhC2zhgtZqXp3bKJRWog35KpYtOObS/UIraqit7vXF9+DUY4BmDigEmsOBkuiOS3EY9vziu/YfE08/4MUpu9TYMZR0CMFAG6Yt3fr2w93P501XEBacZCQi5E42tcjghn99o9/63r2LLj0/khc7019tX8YBwjN8ZG6QtP3tztDbSBS4vCZiuYT1JoGRUujVofXh3m0sl4beCg6+JnbvqmBTIrmo6ZQ31YMoS8TlrFqpxDobkIFxLisck8c1Hj2wItPKaZ8Gy62Q2PKNJbq9gGGlQmLa2QQRuwcn8XfnPRPQzcKnDuOq/iXanIypEBIy6bB5zVTBfYxKeTN189V3OAp8N9BmbnNqAbfqwJQbBkFzLuaz/ltNpVj7YBakvo+9bzFl208n5O84qjCT++QgNsgiwR/sPEwIApRb7dTHPrvhKvinoyf4h4Irwv0rQIw4YsRb+atbxqvpsplDJoID4uC2t6DOocR4fmCBh5WiAbQoCOwlTNkLQkAb6eARQ7sCkCeIUHssJmqVvRpTfWEkZR3vo3WZnQkbDIZRT/BUpS6Oj0huemDKqZGIYTmDmYouH6d52+mGje+yaKOKP7IB6Ri6kya6guxxMOrKqscRn5UvvmKBIK3kaOsppNEWvVxYG+d8="
  file:
    - "bulatov2.pdf"
  skip_cleanup: true
  overwrite: true
  on:
    all_branches: true
    condition: $TRAVIS_BRANCH =~ ^(master|devel)$

tags:
  except:
    - latest
    - devel-latest
