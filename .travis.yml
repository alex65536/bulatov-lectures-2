dist: bionic

language: generic

addons:
  apt:
    packages:
      # required to build
      - cm-super
      - texlive
      - texlive-lang-cyrillic
      - texlive-science
      - texlive-latex-extra
      - latexmk

install:
    # download a newer latexmk
    - curl https://ctan.mirror.norbert-ruehl.de/support/latexmk.zip -o /tmp/latexmk.zip
    - unzip /tmp/latexmk.zip latexmk/latexmk.pl

script: |
    if [[ "$TRAVIS_BRANCH" == "devel" ]]; then
        make LATEXMK="./latexmk/latexmk.pl" build
    else
        make LATEXMK="./latexmk/latexmk.pl" LATEXMK_FLAGS="-Werror" style build
    fi

before_deploy: |
    # rename the pdf file
    cp main.pdf bulatov2.pdf
    # set up git user name and tag this commit
    git config --local user.name "travis"
    git config --local user.email "travis"
    TRAVIS_TAG=latest
    [[ "$TRAVIS_BRANCH" == "devel" ]] && TRAVIS_TAG=devel-latest
    export TRAVIS_TAG
    echo "Branch is: $TRAVIS_BRANCH"
    echo "Using tag: $TRAVIS_TAG"
    git tag -f $TRAVIS_TAG

deploy:
  provider: releases
  api_key:
    secure: "LW2DlR/v65UaHlrtrI59OMmhIuNflPNBP71c7uZ2JMnZCcJbNiYzeZM+D94Cc6XLxCWReF9pG3VRVMv8mcCNNGw3gImAwaXg0AUp402+yxnpIrVDDwvvWaBCpGODvcY4uYR7jhrxInbpTxvKXVMVX9gPbPRbxLfzCnBSKDkPc6av/yYKaInOCzgKhHYWMSbCpdCofyVlY4IBrKTQYmcSRs18hUgmGkD9NX5Yt33ooESMyNPw/inWUbSndpi9XPuh+5iH0/F3m4BVKVv1vn8/b4+laNvQ/bHjDJi8zkS5LF8FhffvH0ItLYC88j2gTY/75SZn8CN3viUdCu2udq+Ala+vj3gyRu6/2wvCf2tjOnbZNb2JwQprdndavDj2T9PD2uYsQJTd6AK0acaEs59/XRiK7VFjnkYI0SyMqZ2vLw02dyfmzgyJeo6IDfoFRVYFqBmpMIi09dq2iOT+Z6JFwkz/IiGJafl4EpdV+GyffgGA7cAZPn85VR9PFntqXcFwNWBR2UsgKWk8pdJEKu1GIOMA6W/9MXW5Yr5aSnqyImH6pzNrGrinKEru7ctYS2aY2nwWrr0FH1KM8Wc4YUy9pU7oN9iyaVeVsRYvzp4QtMKu8APhatvqNDcl0f+oO1Gn993O1qKrB+fedc6IoHrmv9ydLNdVmVGjl2niKfMGy+0="
  file:
    - "bulatov2.pdf"
  skip_cleanup: true
  overwrite: true
  on:
    all_branches: true
    condition: $TRAVIS_BRANCH =~ ^(master|devel)$

tags:
  except:
    - latest
    - devel-latest
